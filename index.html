<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à AEO/SEO ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --code-bg: #f1f5f9;
            --advice-bg: #fffbeb;
            /* Soft Yellow */
            --advice-text: #92400e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            /* Thai friendly font */
            background-color: var(--bg);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        /* Header & Input Section */
        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .input-group {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        input[type="url"] {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
            min-width: 250px;
        }

        input[type="url"]:focus {
            border-color: var(--primary);
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Sarabun', sans-serif;
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Results Section */
        #results-area {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Gauge Card */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: sticky;
            top: 2rem;
        }

        .gauge {
            position: relative;
            width: 200px;
            height: 100px;
            border-radius: 200px 200px 0 0;
            background: #e2e8f0;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .gauge-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--success);
            transform-origin: bottom center;
            transform: rotate(-180deg);
            transition: transform 1.5s cubic-bezier(0.1, 0.7, 1.0, 0.1);
        }

        .gauge-cover {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 80px;
            background: var(--card-bg);
            border-radius: 160px 160px 0 0;
        }

        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-main);
            margin-top: -3rem;
            position: relative;
            z-index: 2;
        }

        .score-label {
            color: var(--text-muted);
            font-weight: 500;
            margin-top: 0.5rem;
        }

        /* Accordion List */
        .accordion {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .accordion-item {
            background: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            overflow: hidden;
            transition: box-shadow 0.2s;
        }

        .accordion-item:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
        }

        .accordion-header {
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            background: var(--card-bg);
            user-select: none;
        }

        .accordion-header:hover {
            background-color: #f8fafc;
        }

        .status-icon {
            width: 1.5rem;
            height: 1.5rem;
            margin-right: 1rem;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .status-pass {
            color: var(--success);
            background: #dcfce7;
        }

        .status-fail {
            color: var(--danger);
            background: #fee2e2;
        }

        .acc-title {
            flex: 1;
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-main);
        }

        .acc-score {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-right: 1rem;
            padding: 0.25rem 0.5rem;
            background: #f1f5f9;
            border-radius: 0.5rem;
        }

        .chevron {
            transition: transform 0.3s ease;
            color: var(--text-muted);
        }

        .accordion-item.active .chevron {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease;
            background-color: #fcfcfc;
            border-top: 1px solid transparent;
        }

        .accordion-item.active .accordion-content {
            max-height: 1000px;
            /* Expand limit */
            padding: 1.25rem;
            border-top-color: var(--border);
            overflow-y: auto;
        }

        .data-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .advice-box {
            background-color: var(--advice-bg);
            color: var(--advice-text);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.95rem;
            border-left: 4px solid #f59e0b;
        }

        .advice-warning {
            background-color: #fff7ed;
            color: #9a3412;
            border-left-color: #f97316;
        }

        .raw-data-box {
            background: var(--code-bg);
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            color: #334155;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .tag-h1 {
            color: #f59e0b;
            font-weight: 700;
        }

        .tag-h2 {
            color: #2563eb;
            font-weight: 600;
            margin-left: 1rem;
        }

        .tag-h3 {
            color: #64748b;
            margin-left: 2rem;
        }

        .copy-btn {
            background: white;
            border: 1px solid var(--border);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--text-muted);
            font-family: 'Sarabun', sans-serif;
        }

        .copy-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Loading Spinner */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .loader-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error-message {
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #fecaca;
            display: none;
        }

        /* Schema Badges */
        .schema-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .badge-aeo {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        /* Tier 1 */
        .badge-rich {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        /* Tier 2 */
        .badge-basic {
            background-color: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        /* Tier 3 */
        .badge-unknown {
            background-color: #f3f4f6;
            color: #6b7280;
        }

        .schema-code-toggle {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.875rem;
            cursor: pointer;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        /* Developer Fix Box (Terminal Check) */
        .dev-fix-box {
            margin-top: 1rem;
            background-color: #111827;
            /* Gray-900 */
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid #374151;
            /* Gray-700 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .dev-fix-header {
            background-color: #1f2937;
            /* Gray-800 */
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #374151;
        }

        .dev-fix-title {
            color: #fbbf24;
            /* Amber */
            font-size: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Sarabun', sans-serif;
        }

        .dev-fix-copy-btn {
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .dev-fix-copy-btn:hover {
            background-color: #1d4ed8;
        }

        .dev-fix-copy-btn.copied {
            background-color: #10b981;

            .dev-fix-content {
                padding: 1rem;
                color: #4ade80;
                /* Terminal Green */
                font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            }

            .dev-fix-content {
                padding: 1rem;
                color: #4ade80;
                /* Terminal Green */
                font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                font-size: 0.85rem;
                white-space: pre-wrap;
                line-height: 1.6;
            }

            /* Technical Health Grid */
            .tech-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 1rem;
                margin-top: 1rem;
            }

            @media (min-width: 640px) {
                .tech-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }

            .tech-item {
                background-color: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                padding: 1rem;
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            .tech-icon {
                font-size: 1.5rem;
                flex-shrink: 0;
            }

            .tech-info {
                flex: 1;
            }

            .tech-title {
                font-weight: 700;
                color: #334155;
                font-size: 0.95rem;
                margin-bottom: 0.1rem;
            }

            .tech-desc {
                font-size: 0.8rem;
                color: #64748b;
                line-height: 1.3;
            }

            /* Hardcoded Utilities for Tech Grid */
            .grid {
                display: grid;
            }

            .grid-cols-1 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }

            @media (min-width: 768px) {
                .md\:grid-cols-2 {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }
            }

            .gap-3 {
                gap: 0.75rem;
            }

            .mt-4 {
                margin-top: 1rem;
            }

            .flex {
                display: flex;
            }

            .flex-row {
                flex-direction: row;
            }

            .flex-col {
                flex-direction: column;
            }

            .items-center {
                align-items: center;
            }

            .p-3 {
                padding: 0.75rem;
            }

            .bg-gray-50 {
                background-color: #f9fafb;
            }

            .border {
                border-width: 1px;
            }

            .border-gray-200 {
                border-color: #e5e7eb;
            }

            .rounded-lg {
                border-radius: 0.5rem;
            }

            .shadow-sm {
                box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            }

            .flex-shrink-0 {
                flex-shrink: 0;
            }

            .mr-3 {
                margin-right: 0.75rem;
            }

            .text-2xl {
                font-size: 1.5rem;
                line-height: 2rem;
            }

            .font-bold {
                font-weight: 700;
            }

            .text-sm {
                font-size: 0.875rem;
                line-height: 1.25rem;
            }

            .text-gray-700 {
                color: #374151;
            }

            .uppercase {
                text-transform: uppercase;
            }

            .text-xs {
                font-size: 0.75rem;
                line-height: 1rem;
            }

            .text-gray-500 {
                color: #6b7280;
            }
    </style>
</head>

<body>

    <div class="loader-overlay" id="loader">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <header>
            <h1>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à AEO/SEO</h1>
            <p class="subtitle">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Answer Engine Optimization</p>
        </header>

        <div class="input-group">
            <input type="url" id="urlInput" placeholder="https://example.com" required>
            <button id="analyzeBtn" onclick="analyzeSite()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå
            </button>
        </div>

        <div id="errorMsg" class="error-message"></div>

        <div id="results-area">
            <div class="dashboard-grid">

                <!-- Score Card -->
                <div class="card gauge-container">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</h2>
                    <div class="gauge">
                        <div class="gauge-fill" id="gaugeFill"></div>
                        <div class="gauge-cover"></div>
                    </div>
                    <div class="score-display" id="scoreValue">0</div>
                    <div class="score-label" id="scoreText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...</div>
                </div>

                <!-- Accordion Results -->
                <div class="accordion" id="accordionList">
                    <!-- Items will be injected here -->
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Robust Proxy Configuration ---
        const PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://thingproxy.freeboard.io/fetch/'
        ];

        async function fetchWithFallback(targetUrl) {
            const encodedUrl = encodeURIComponent(targetUrl);
            let lastError = null;
            const btn = document.getElementById('analyzeBtn');

            for (let i = 0; i < PROXIES.length; i++) {
                const proxy = PROXIES[i];
                try {
                    // Update UI if retrying (not the first one)
                    if (i > 0) {
                        btn.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà ${i}...`;
                    }

                    console.log(`Trying proxy: ${proxy}`);
                    const response = await fetch(proxy + encodedUrl);
                    if (!response.ok) throw new Error(`Status ${response.status}`);

                    const text = await response.text();
                    if (!text || text.trim().length === 0) throw new Error('Empty response');
                    return text;

                } catch (err) {
                    console.warn(`Proxy failed: ${proxy}`, err);
                    lastError = err;
                    // Provide immediate feedback before next loop
                    btn.innerHTML = `‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á...`;
                }
            }
            throw new Error('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á (Firewall) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ü‡∏£‡∏µ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á');
        }

        async function analyzeSite() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();

            if (!url) {
                showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                return;
            }

            hideError();
            setLoading(true);
            document.getElementById('results-area').style.display = 'none';

            try {
                const htmlContent = await fetchWithFallback(url);
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');

                const results = performAnalysis(doc, url); // Pass url to performAnalysis
                renderResults(results);
                document.getElementById('results-area').style.display = 'block';

            } catch (err) {
                showError(err.message);
                console.error(err);
            } finally {
                setLoading(false);
            }
        }

        function performAnalysis(doc, pageUrl) { // Accept pageUrl as argument
            const targetUrl = pageUrl; // Fix: Assign pageUrl to targetUrl for sub-modules
            const items = [];

            // 1. Meta Tags Analysis
            const title = doc.querySelector('title') ? doc.querySelector('title').innerText.trim() : "";
            const metaDesc = doc.querySelector('meta[name="description"]') ? doc.querySelector('meta[name="description"]').content.trim() : "";

            const titleLen = title.length;
            const descLen = metaDesc.length;
            const titlePass = titleLen >= 30 && titleLen <= 65;
            const descPass = descLen >= 50 && descLen <= 160;
            const metaScore = (titlePass ? 10 : 0) + (descPass ? 10 : 0);

            // Smart Advice: Meta Tags
            let titleAdvice = "";
            if (titleLen > 65) {
                titleAdvice = `Title ‡∏¢‡∏≤‡∏ß ${titleLen} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤ ${titleLen - 65} ‡∏ï‡∏±‡∏ß) ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ñ‡∏π‡∏Å Google ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else if (titleLen < 30) {
                titleAdvice = `Title ‡∏™‡∏±‡πâ‡∏ô‡πÑ‡∏õ‡∏ô‡∏¥‡∏î (‡πÅ‡∏Ñ‡πà ${titleLen} ‡∏ï‡∏±‡∏ß) ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ü‡∏£‡∏µ ‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else {
                titleAdvice = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß Title ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (${titleLen} ‡∏ï‡∏±‡∏ß) ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô Google ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`;
            }

            let descAdvice = "";
            if (descLen > 160) {
                descAdvice = `Description ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (${descLen} ‡∏ï‡∏±‡∏ß) ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏≠‡∏≤‡∏à‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else if (descLen < 50) {
                descAdvice = `Description ‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else {
                descAdvice = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß Description ‡∏î‡∏µ‡∏°‡∏≤‡∏Å (${descLen} ‡∏ï‡∏±‡∏ß) ‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`;
            }

            items.push({
                id: 'meta',
                title: "Meta Tags (Title & Description)",
                score: metaScore,
                maxScore: 20,
                pass: metaScore >= 10,
                dataLabel: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (Title) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Description)",
                advice: `<strong>Title:</strong> ${titleAdvice}<br><br><strong>Description:</strong> ${descAdvice}`,
                dataContent: `Title (${titleLen} chars):\n${title}\n\nDescription (${descLen} chars):\n${metaDesc || "‡πÑ‡∏°‡πà‡∏û‡∏ö Meta Description"}`,
                copyText: `Title:\n${title}\n\nDescription:\n${metaDesc}`
            });

            // 2. Headings
            const headers = Array.from(doc.querySelectorAll('h1, h2, h3'));
            const headerData = headers.map(h => ({
                tag: h.tagName.toLowerCase(),
                text: h.innerText.trim()
            })).filter(h => h.text.length > 0);

            const h1 = headerData.find(h => h.tag === 'h1');
            const h1Pass = !!h1 && h1.text.length > 10;

            const h3Count = headerData.filter(h => h.tag === 'h3').length;

            let headingAdvice = "";
            let headingClass = "";

            if (!h1) {
                headingAdvice = "‡πÑ‡∏°‡πà‡∏û‡∏ö H1! ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ H1 ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö";
                headingClass = "advice-warning";
            } else if (h3Count > 0) {
                headingAdvice = "‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÑ‡∏•‡πà‡∏•‡∏≥‡∏î‡∏±‡∏ö H1 > H2 > H3 ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô AI ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö";
            } else { // h3Count === 0
                headingAdvice = "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (‡∏°‡∏µ H1, H2) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö H3 ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° H3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö";
                headingClass = "advice-warning";
            }

            items.push({
                id: 'headings',
                title: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (Heading Structure)",
                score: h1Pass ? 15 : 0,
                maxScore: 15,
                pass: h1Pass,
                dataLabel: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏û‡∏ö (H1-H3)",
                advice: headingAdvice,
                adviceClass: headingClass,
                dataContent: headerData.map(h => `<span class='tag-${h.tag}'>[${h.tag.toUpperCase()}]</span> ${h.text}`).join('\n') || "‡πÑ‡∏°‡πà‡∏û‡∏ö H1-H3",
                copyText: headerData.map(h => `[${h.tag.toUpperCase()}] ${h.text}`).join('\n')
            });

            // 3. Voice Search
            const targetKeywords = ['‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£', '‡πÑ‡∏´‡∏°', '‡∏£‡∏≤‡∏Ñ‡∏≤', '‡∏ß‡∏¥‡∏ò‡∏µ', 'How to', 'What is', 'How much', 'Cost', 'Guide', 'Best'];
            const matchedKeywords = [];
            headerData.forEach(h => {
                targetKeywords.forEach(kw => {
                    if (h.text.toLowerCase().includes(kw.toLowerCase()) && !matchedKeywords.includes(kw)) {
                        matchedKeywords.push(kw);
                    }
                });
            });
            const voicePass = matchedKeywords.length > 0;

            // Smart Advice: Voice Search
            let voiceAdvice = "";
            if (voicePass) {
                voiceAdvice = `‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ${matchedKeywords.join(', ')} ‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else {
                voiceAdvice = `‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô H2/H3 ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà", "‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", "‡∏î‡∏µ‡πÑ‡∏´‡∏°" ‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö`;
            }

            items.push({
                id: 'voice',
                title: "‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Voice Search)",
                score: voicePass ? 20 : 0,
                maxScore: 20,
                pass: voicePass,
                dataLabel: "Keyword ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠",
                advice: voiceAdvice,
                dataContent: voicePass ? `‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ${matchedKeywords.join(', ')}` : "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô H1-H3",
                copyText: matchedKeywords.join(', ')
            });

            // 4. Schema Markup (Deep Dive & Strict Scoring + Smart Fix)
            const scripts = Array.from(doc.querySelectorAll('script[type="application/ld+json"]'));
            let typesFound = [];
            let rawJsonList = [];

            // 1. Deep Dive Extraction
            scripts.forEach(script => {
                try {
                    const json = JSON.parse(script.innerText);
                    rawJsonList.push(json);

                    // Check 1: @graph
                    if (json['@graph'] && Array.isArray(json['@graph'])) {
                        json['@graph'].forEach(item => {
                            if (item['@type']) typesFound.push(item['@type']);
                        });
                    }
                    // Check 2: Top-level @type
                    else if (json['@type']) {
                        const t = json['@type'];
                        if (Array.isArray(t)) typesFound.push(...t);
                        else typesFound.push(t);
                    }
                } catch (e) {
                    console.error("Schema Parse Error", e);
                }
            });

            // Clean up: Flatten & Unique
            typesFound = [...new Set(typesFound.flat())].filter(t => t);

            // 2. Strict Scoring
            let schemaScore = 0;
            const hasAeo = typesFound.some(t => ['FAQPage', 'HowTo', 'QAPage'].includes(t));
            const hasRich = typesFound.some(t => ['Article', 'NewsArticle', 'Product', 'Review', 'VideoObject'].includes(t));

            if (hasAeo) {
                schemaScore = 20;
            } else if (hasRich) {
                schemaScore = 10;
            } else {
                schemaScore = 0;
            }

            // 3. UI & Advice & Smart Fix
            const schemaPass = schemaScore >= 10;
            let schemaAdvice = "";
            let schemaAdviceClass = "";
            let fixHtml = "";

            // Get Context for Prompt
            const pageTitle = doc.title || (doc.querySelector('h1') ? doc.querySelector('h1').innerText : "This Page");

            if (schemaScore === 20) {
                schemaAdvice = "üèÜ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ó‡∏û! ‡∏°‡∏µ Schema ‡∏™‡∏≤‡∏¢ AEO ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
            } else {
                if (schemaScore === 10) {
                    schemaAdvice = "‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏≤‡∏ñ‡∏π‡∏Å‡∏ó‡∏≤‡∏á! ‡∏û‡∏ö Schema ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏¥‡∏î Voice Search ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° FAQPage ‡∏´‡∏£‡∏∑‡∏≠ HowTo ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡∏ö";
                } else { // 0
                    schemaAdvice = "‚ö†Ô∏è ‡∏™‡∏≠‡∏ö‡∏ï‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Voice Search! ‡πÄ‡∏ß‡πá‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Breadcrumb) ‡∏ã‡∏∂‡πà‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° FAQPage Schema ‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!";
                    schemaAdviceClass = "advice-warning";
                }

                // Generate Smart Prompt (Geek Feature)
                const fixPrompt = `Act as a Senior Technical SEO Specialist.
My website page title is: "${pageTitle}"
The current Schema Markup is missing "FAQPage" which is crucial for AEO (Voice Search).

Task:
Write a valid JSON-LD "FAQPage" Schema markup for this page.
1. Generate 3 frequently asked questions (Q&A) relevant to "${pageTitle}".
2. The questions should be optimized for Voice Search (Natural Language).
3. The answers must be concise (40-50 words) to target Featured Snippets.
4. Output only the JSON-LD code block.`;

                fixHtml = `
                    <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 0.75rem; margin-top: 1rem; border-radius: 0.25rem; font-size: 0.85rem; color: #0c4a6e;">
                        <strong>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏µ‡∏î‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô ChatGPT ‡∏´‡∏£‡∏∑‡∏≠ Gemini ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    </div>
                    <div class="dev-fix-box" style="margin-top: 0.5rem;">
                        <div class="dev-fix-header">
                            <div class="dev-fix-title">üõ†Ô∏è Developer Quick Fix</div>
                            <button class="dev-fix-copy-btn" onclick="copyPromptText(this)">Copy Prompt</button>
                        </div>
                        <div class="dev-fix-content">${fixPrompt}</div>
                    </div>
                 `;
            }

            const typeLabel = typesFound.length > 0 ? `‡∏û‡∏ö Schema: ${typesFound.join(', ')}` : "‡πÑ‡∏°‡πà‡∏û‡∏ö Schema Markup";
            const jsonDump = rawJsonList.length > 0 ? JSON.stringify(rawJsonList, null, 2) : "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Code";

            // Badges HTML
            const badgesHtml = typesFound.map(t => {
                let badgeClass = 'badge-unknown';
                if (['FAQPage', 'HowTo', 'QAPage'].includes(t)) badgeClass = 'badge-aeo';
                else if (['Article', 'NewsArticle', 'Product', 'Review'].includes(t)) badgeClass = 'badge-rich';
                else badgeClass = 'badge-basic';
                return `<span class="schema-badge ${badgeClass}">${t}</span>`;
            }).join('');

            items.push({
                id: 'schema',
                title: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Schema Markup)",
                score: schemaScore,
                maxScore: 20,
                pass: schemaPass,
                dataLabel: typeLabel,
                advice: schemaAdvice,
                adviceClass: schemaAdviceClass,
                dataContent: `<div>${badgesHtml || typeLabel}</div>
                              ${fixHtml}
                              <button class="schema-code-toggle" onclick="toggleSchemaCode(this)">‡∏î‡∏π Code ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏° ‚ñº</button>
                              <div class="schema-code-container">${jsonDump}</div>`,
                copyText: jsonDump
            });

            // 5. Image Alt Text (Strict & Evidence-Based)
            const images = Array.from(doc.querySelectorAll('img'));
            let totalAnalyzed = 0;
            let badImages = [];

            images.forEach(img => {
                // Filter: Ignore tiny pixels or hidden images (Best effort)
                const width = img.getAttribute('width');
                const height = img.getAttribute('height');
                const style = img.getAttribute('style') || "";

                if (style.includes('display: none')) return;
                if (width && parseInt(width) < 5) return;
                if (height && parseInt(height) < 5) return;

                totalAnalyzed++;

                // Check Alt
                const alt = img.getAttribute('alt');
                if (alt === null || alt.trim() === "") {
                    // Collect evidence (Max 5)
                    const src = img.getAttribute('src') || "(No SRC)";
                    badImages.push(src);
                }
            });

            // Scoring
            let altScore = 0;
            if (badImages.length === 0) altScore = 10;
            else if (badImages.length <= 2) altScore = 5;
            else altScore = 0;

            const altPass = altScore >= 5;

            // Advice
            let imgAdvice = "";
            let imgAdviceClass = "";

            if (totalAnalyzed === 0) {
                imgAdvice = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà)";
                altScore = 10; // Neutral/Pass
            } else if (badImages.length === 0) {
                imgAdvice = `‚úÖ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á ${totalAnalyzed} ‡∏£‡∏π‡∏õ ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Alt Text) ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏î‡∏µ‡∏ï‡πà‡∏≠ SEO ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else {
                imgAdvice = `‚ö†Ô∏è ‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ${badImages.length} ‡∏£‡∏π‡∏õ (‡∏à‡∏≤‡∏Å ${totalAnalyzed}) ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Alt Text) ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ Google ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å`;
                if (badImages.length > 2) imgAdviceClass = "advice-warning";
            }

            // Evidence List
            let evidenceHtml = "";
            if (badImages.length > 0) {
                const listItems = badImages.slice(0, 5).map(src => `<li style="margin-bottom:4px;word-break:break-all;">${src.substring(0, 80)}${src.length > 80 ? '...' : ''}</li>`).join('');
                evidenceHtml = `<ul style="margin-top:0.5rem; padding-left:1.5rem; font-size:0.85rem; color:#b91c1c;">${listItems}</ul>`;
                if (badImages.length > 5) evidenceHtml += `<div style="font-size:0.8rem; margin-top:4px; color:#666;">(‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${badImages.length - 5} ‡∏£‡∏π‡∏õ...)</div>`;
            }

            items.push({
                id: 'images',
                title: "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Image Alt Text)",
                score: altScore,
                maxScore: 10,
                pass: altPass,
                dataLabel: "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Alt Text",
                advice: imgAdvice,
                adviceClass: imgAdviceClass,
                dataContent: `<div>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${totalAnalyzed}</div>
                              <div>‡πÑ‡∏°‡πà‡∏°‡∏µ Alt Text: <strong>${badImages.length}</strong></div>
                              ${evidenceHtml}`,
                copyText: `Total Images Analyzed: ${totalAnalyzed}\nMissing Alt: ${badImages.length}\nSample Missing: ${badImages.slice(0, 5).join(', ')}`
            });

            // 6. Content Depth
            const paragraphs = Array.from(doc.querySelectorAll('p'));
            const firstP = paragraphs.find(p => p.innerText.trim().length > 50);
            const bodyText = doc.body.innerText || "";
            const wordCount = bodyText.trim().split(/\s+/).length;

            let contentScore = 0;
            if (wordCount > 500) contentScore = 15;
            else if (wordCount > 300) contentScore = 10;
            else contentScore = 5;

            // Smart Advice: Content
            let contentAdvice = "";
            if (wordCount < 300) {
                contentAdvice = `‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏Å (${wordCount} ‡∏Ñ‡∏≥) ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô Thin Content ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2-3 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else if (wordCount <= 500) {
                contentAdvice = `‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (${wordCount} ‡∏Ñ‡∏≥) ‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏∞ 600 ‡∏Ñ‡∏≥‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else {
                contentAdvice = `‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏õ‡∏∂‡πâ‡∏Å! (${wordCount} ‡∏Ñ‡∏≥) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ AI ‡∏ä‡∏≠‡∏ö‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á`;
            }

            items.push({
                id: 'content',
                title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Content Depth)",
                score: contentScore,
                maxScore: 15,
                pass: contentScore >= 10,
                dataLabel: "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≥‡πÅ‡∏•‡∏∞‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
                advice: contentAdvice,
                dataContent: `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥: ${wordCount}\n\n‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å:\n${firstP ? firstP.innerText.substring(0, 200) + '...' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠'}`,
                copyText: `Word Count: ${wordCount}\n\nFirst Paragraph:\n${firstP ? firstP.innerText : ''}`
            });

            // 7. Link Health Structure
            const allLinks = Array.from(doc.querySelectorAll('a'));
            const host = new URL(targetUrl).hostname;
            let internal = 0, external = 0, empty = 0;

            allLinks.forEach(a => {
                const href = a.getAttribute('href');
                if (!href || href === '#' || href.toLowerCase().startsWith('javascript:')) {
                    empty++;
                } else {
                    try {
                        const linkUrl = new URL(href, targetUrl);
                        if (linkUrl.hostname === host) internal++;
                        else external++;
                    } catch (e) { empty++; }
                }
            });

            let linkScore = 0;
            if (internal > 2) linkScore += 5;
            if (external > 0) linkScore += 5;
            if (empty > 0) linkScore = Math.max(0, linkScore - 5); // Penalty

            items.push({
                id: 'links',
                title: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå (Link Health)",
                score: linkScore,
                maxScore: 10,
                pass: linkScore >= 5 && empty === 0,
                dataLabel: "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏•‡∏¥‡∏á‡∏Å‡πå",
                advice: empty > 0 ? `‚ùå ‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏õ‡∏•‡πà‡∏≤ ${empty} ‡∏à‡∏∏‡∏î (‡πÄ‡∏ä‡πà‡∏ô #) ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏£‡∏±‡∏ö` : (internal === 0 ? "‚ö†Ô∏è ‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Internal Linking) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Google ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏Å" : "‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö"),
                dataContent: `Internal: ${internal}, External: ${external}, Empty/Broken: ${empty}`,
                copyText: `Internal: ${internal}\nExternal: ${external}\nBroken: ${empty}`
            });

            // 9. AI Readability (Structure)
            const listCount = doc.querySelectorAll('ul, ol').length;
            const tableCount = doc.querySelectorAll('table').length;
            const boldCount = doc.querySelectorAll('strong, b').length;

            let aiScore = 0;
            if (listCount >= 2) aiScore += 5;
            if (tableCount > 0) aiScore += 3;
            if (boldCount > 5) aiScore += 2;
            // Cap at 10 (Though total above is 10)

            items.push({
                id: 'ai-read',
                title: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI (AI Readability)",
                score: aiScore,
                maxScore: 10,
                pass: aiScore >= 5,
                dataLabel: "‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏Å‡∏±‡∏ö AI",
                advice: aiScore > 7 ? "üí° ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bullet Points, ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ AI ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢" : "üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö AEO: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bullet Points (Lists) ‡πÅ‡∏•‡∏∞ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Table) ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ AI ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö",
                dataContent: `Lists (ul/ol): ${listCount}\nTables: ${tableCount}\nBold Text: ${boldCount}`,
                copyText: `Lists: ${listCount}\nTables: ${tableCount}\nBold: ${boldCount}`
            });

            // 10. Technical Performance (Resource Count)
            const scriptCount = doc.querySelectorAll('script').length;
            const cssCount = doc.querySelectorAll('link[rel="stylesheet"], style').length;

            let perfScore = 10;
            let perfAdvice = "üü¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ";

            if (scriptCount > 15) {
                perfScore -= 5;
                perfAdvice = `üî¥ ‡∏û‡∏ö JavaScript ${scriptCount} ‡πÑ‡∏ü‡∏•‡πå! ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏ä‡πâ‡∏≤`;
            } else if (cssCount > 10) {
                perfAdvice = `üü† ‡πÑ‡∏ü‡∏•‡πå CSS ‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (${cssCount}) ‡∏Ñ‡∏ß‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå`;
            }

            items.push({
                id: 'perf',
                title: "‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ (Resource Count)",
                score: perfScore,
                maxScore: 10,
                pass: perfScore > 5,
                dataLabel: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå Resource",
                advice: perfAdvice,
                dataContent: `Scripts (JS): ${scriptCount}\nStyles (CSS): ${cssCount}`,
                copyText: `JS Files: ${scriptCount}\nCSS Files: ${cssCount}`
            });


            // 11. Technical & Indexing (Critical Checks)
            const canonical = doc.querySelector('link[rel="canonical"]')?.href || "";
            const robots = doc.querySelector('meta[name="robots"]')?.content || "";
            const viewport = doc.querySelector('meta[name="viewport"]')?.content || "";
            const favicon = doc.querySelector('link[rel="icon"], link[rel="shortcut icon"]')?.href || "";

            let techScore = 0;
            let isCritical = false; // For Auto-Open

            // 1. Canonical
            const canonicalPass = !!canonical;
            if (canonicalPass) techScore += 4;
            const canonicalIcon = canonicalPass ? '‚úÖ' : '‚ö†Ô∏è';
            const canonicalMsg = canonicalPass ? '‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' : '‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ã‡πâ‡∏≥';

            // 2. Robots
            const robotsFail = robots.includes("noindex");
            if (robotsFail) {
                isCritical = true;
                techScore = 0;
            } else {
                techScore += 3;
            }
            const robotsPass = !robotsFail;
            const robotsIcon = robotsPass ? '‚úÖ' : 'üî¥';
            const robotsMsg = robotsPass ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô Google' : '‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏Å‡∏±‡πâ‡∏ô (Noindex)';


            // 3. Viewport
            const viewportPass = !!viewport;
            if (viewportPass) {
                techScore += 2;
            } else {
                isCritical = true;
            }
            const viewportIcon = viewportPass ? '‚úÖ' : 'üî¥';
            const viewportMsg = viewportPass ? '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 100%' : '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠';


            // 4. Favicon
            const faviconPass = !!favicon;
            if (faviconPass) techScore += 1;
            const faviconIcon = faviconPass ? '‚úÖ' : 'üü†';
            const faviconMsg = faviconPass ? '‡∏î‡∏π‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠' : '‡∏Ç‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ';

            // FORCE INLINE STYLES (As Requested)
            let techGridHtml = `
            <div style="width: 100%; display: grid !important; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important; gap: 10px !important; white-space: normal !important; font-family: sans-serif !important;">
                
                <div style="display: flex !important; flex-direction: row !important; align-items: center !important; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #eee;">
                    <div style="font-size: 24px; margin-right: 12px;">${canonicalIcon}</div>
                    <div style="display: flex; flex-direction: column;">
                        <div style="font-weight: bold; font-size: 14px; color: #333; text-transform: uppercase;">Canonical</div>
                        <div style="font-size: 12px; color: #666;">${canonicalMsg}</div>
                    </div>
                </div>

                <div style="display: flex !important; flex-direction: row !important; align-items: center !important; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #eee;">
                    <div style="font-size: 24px; margin-right: 12px;">${robotsIcon}</div>
                    <div style="display: flex; flex-direction: column;">
                        <div style="font-weight: bold; font-size: 14px; color: #333; text-transform: uppercase;">Robots Status</div>
                        <div style="font-size: 12px; color: #666;">${robotsMsg}</div>
                    </div>
                </div>

                <div style="display: flex !important; flex-direction: row !important; align-items: center !important; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #eee;">
                    <div style="font-size: 24px; margin-right: 12px;">${viewportIcon}</div>
                    <div style="display: flex; flex-direction: column;">
                        <div style="font-weight: bold; font-size: 14px; color: #333; text-transform: uppercase;">Mobile Viewport</div>
                        <div style="font-size: 12px; color: #666;">${viewportMsg}</div>
                    </div>
                </div>

                <div style="display: flex !important; flex-direction: row !important; align-items: center !important; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #eee;">
                    <div style="font-size: 24px; margin-right: 12px;">${faviconIcon}</div>
                    <div style="display: flex; flex-direction: column;">
                        <div style="font-weight: bold; font-size: 14px; color: #333; text-transform: uppercase;">Site Icon</div>
                        <div style="font-size: 12px; color: #666;">${faviconMsg}</div>
                    </div>
                </div>

            </div>`;

            let techAdvice = "‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
            let techAdviceClass = "";

            if (isCritical) {
                techAdvice = "üî¥ ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ! ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ";
                techAdviceClass = "advice-warning";
            } else if (techScore < 10) {
                techAdvice = "‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å SEO";
                techAdviceClass = "advice-warning";
            }

            items.push({
                id: 'tech',
                title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ (Technical & Indexing)",
                score: techScore,
                maxScore: 10,
                pass: techScore >= 8 && !isCritical,
                autoOpen: isCritical,
                dataLabel: "‡∏ú‡∏•‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Health Check)",
                advice: techAdvice,
                adviceClass: techAdviceClass,
                dataContent: techGridHtml,
                hideCopy: true, // Hide Copy Button
                copyText: `Canonical: ${canonical}\nRobots: ${robots}\nViewport: ${viewport}`
            });

            // Calc Total
            const rawScore = items.reduce((acc, item) => acc + item.score, 0);
            const totalMax = items.reduce((acc, item) => acc + item.maxScore, 0);
            const finalScore = totalMax > 0 ? Math.round((rawScore / totalMax) * 100) : 0;

            return {
                score: finalScore,
                items: items
            };
        }

        function renderResults(results) {
            // Update Gauge
            const gaugeFill = document.getElementById('gaugeFill');
            const scoreValue = document.getElementById('scoreValue');
            const scoreText = document.getElementById('scoreText');

            const degrees = (results.score / 100) * 180 - 180;
            gaugeFill.style.transform = `rotate(${degrees}deg)`;

            let color = '#ef4444'; let text = "‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á";
            if (results.score >= 50) { color = '#f59e0b'; text = "‡∏û‡∏≠‡πÉ‡∏ä‡πâ"; }
            if (results.score >= 80) { color = '#10b981'; text = "‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°"; }

            gaugeFill.style.background = color;
            scoreValue.style.color = color;
            scoreText.innerText = text;
            scoreValue.innerText = results.score;

            // Render Accordion
            const list = document.getElementById('accordionList');
            list.innerHTML = '';

            results.items.forEach(item => {
                const el = document.createElement('div');
                el.className = `accordion-item ${item.autoOpen ? 'active' : ''}`; // Handle Auto-Open

                el.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div class="status-icon ${item.pass ? 'status-pass' : 'status-fail'}">
                            ${item.pass
                        ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>'
                        : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'
                    }
                        </div>
                        <div class="acc-title">${item.title}</div>
                        <div class="acc-score">${item.score}/${item.maxScore}</div>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                    <div class="accordion-content">
                        <div class="data-label">
                            <span>${item.dataLabel}</span>
                            ${item.hideCopy ? '' : `<button class="copy-btn" onclick="event.stopPropagation(); copyData('${item.id}')">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>`}
                        </div>
                        <div class="raw-data-box" id="raw-${item.id}">${item.dataContent}</div>
                        
                        <div class="advice-box ${item.adviceClass || ''}">
                            <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> <br>
                            ${item.advice}
                        </div>

                        <textarea style="display:none;" id="copy-${item.id}">${item.copyText}</textarea>
                    </div>
                `;
                list.appendChild(el);
            });
        }

        function toggleAccordion(header) {
            const item = header.parentElement;
            const isOpen = item.classList.contains('active');

            document.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('active'));

            if (!isOpen) {
                item.classList.add('active');
            }
        }

        function copyData(id) {
            const text = document.getElementById(`copy-${id}`).value;
            navigator.clipboard.writeText(text).then(() => {
                alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            });
        }

        function setLoading(isLoading) {
            const loader = document.getElementById('loader');
            const btn = document.getElementById('analyzeBtn');
            if (isLoading) {
                loader.classList.add('active');
                btn.disabled = true;
                btn.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...';
            } else {
                loader.classList.remove('active');
                btn.disabled = false;
                btn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå
                `;
            }
        }

        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.innerText = msg;
            el.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMsg').style.display = 'none';
        }

        function toggleSchemaCode(btn) {
            const container = btn.nextElementSibling;
            container.classList.toggle('show');
            if (container.classList.contains('show')) {
                btn.innerText = '‡∏ã‡πà‡∏≠‡∏ô Code ‚ñ≤';
            } else {
                btn.innerText = '‡∏î‡∏π Code ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏° ‚ñº';
            }
        }

        function copyPromptText(btn) {
            // Find the content div (sibling of header)
            const contentDiv = btn.parentElement.nextElementSibling;
            const textToCopy = contentDiv.innerText;

            // Robust Copy Logic
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopyFeedback(btn);
                }).catch(err => {
                    console.error('Clipboard API failed', err);
                    fallbackCopyText(textToCopy, btn);
                });
            } else {
                fallbackCopyText(textToCopy, btn);
            }
        }

        function fallbackCopyText(text, btn) {
            const textArea = document.createElement("textarea");
            textArea.value = text;

            // Ensure invisible but part of DOM
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) showCopyFeedback(btn);
            } catch (err) {
                console.error('Fallback copy failed', err);
                alert('Copy failed. Please select text and copy manually.');
            }

            document.body.removeChild(textArea);
        }

        function showCopyFeedback(btn) {
            const originalText = btn.innerText;
            btn.innerText = 'Copied! ‚úÖ';
            btn.classList.add('copied');

            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove('copied');
            }, 2000);
        }

        function copyToClipboard(text) {
            // Keep old function just in case, or alias it
            navigator.clipboard.writeText(text).then(() => {
                alert("Prompt Copied to Clipboard!");
            });
        }
    </script>
</body>

</html>
